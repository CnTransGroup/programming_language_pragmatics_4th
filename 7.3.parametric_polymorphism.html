<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>7.3 Parametric Polymorphism - 编程语言语用论（第4版）</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="foreward.html">Foreword</a></li><li class="chapter-item expanded "><a href="part1.foundations.html">Part I: Foundations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="1.introduction.html">Chapter 1: Introduction</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="1.1.the_art_of_language_design.html">1.1 The Art of Language Design</a></li><li class="chapter-item "><a href="1.2.the_programming_language_spectrum.html">1.2 The Programming Language Spectrum</a></li><li class="chapter-item "><a href="1.3.why_study_programming_language.html">1.3 Why Study Programming Languages?</a></li></ol></li><li class="chapter-item "><a href="2.programming_language_syntax.html">Chapter 2: Programming Language Syntax</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="2.1.specifying_syntax.html">2.1 Specifying Syntax: Regular Expressions and Context-Free Grammars</a></li><li class="chapter-item "><a href="2.2.scanning.html">2.2 Scanning</a></li><li class="chapter-item "><a href="2.3.parsing.html">2.3 Parsing</a></li><li class="chapter-item "><a href="2.4.theoretical_foundations.html">2.4 Theoretical Foundations</a></li></ol></li><li class="chapter-item "><a href="3.names_scopes_bindings.html">Chapter 3: Names, Scopes, and Bindings</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="3.1.the_notion_of_binding_time.html">3.1 The Notion of Binding Time</a></li><li class="chapter-item "><a href="3.2.object_lifetimes_and_storage_management.html">3.2 Object Lifetimes and Storage Management</a></li><li class="chapter-item "><a href="3.3.scope_rules.html">3.3 Scope Rules</a></li><li class="chapter-item "><a href="3.4.implementing_scope.html">3.4 Implementing Scope</a></li><li class="chapter-item "><a href="3.5.the_meaning_of_names_within_a_scope.html">3.5 The Meaning of Names within a Scope</a></li><li class="chapter-item "><a href="3.6.the_binding_of_referencing_environments.html">3.6 The Binding of Referencing Environments</a></li><li class="chapter-item "><a href="3.7.macro_expansion.html">3.7 Macro Expansion</a></li><li class="chapter-item "><a href="3.8.separate_compilation.html">3.8 Separate Compilation</a></li></ol></li><li class="chapter-item "><a href="4.semantic_analysis.html">Chapter 4: Semantic Analysis</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="4.1.the_role_of_the_semantic_analyzer.html">4.1 The Role of The Semantic Analyzer</a></li><li class="chapter-item "><a href="4.2.attribute_grammar.html">4.2 Attribute Grammar</a></li><li class="chapter-item "><a href="4.3.evaluating_attributes.html">4.3 Evaluating Attributes</a></li><li class="chapter-item "><a href="4.4.action_routines.html">4.4 Action Routines</a></li><li class="chapter-item "><a href="4.5.space_management_for_attributes.html">4.5 Space Management for Attributes</a></li><li class="chapter-item "><a href="4.6.tree_grammars_and_syntax_tree_decoration.html">4.6 Tree Grammars and Syntax Tree Decoration</a></li></ol></li><li class="chapter-item "><a href="5.target_machine_architecture.html">Chapter 5: Target Machine Architecture</a></li></ol></li><li class="chapter-item expanded "><a href="part2.core_issues_in_language_design.html">Part II: Core Issues in Language Design</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="6.control_flow.html">Chapter 6: Control Flow</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="6.1.expression_evaluation.html">6.1 Expression evaluation</a></li><li class="chapter-item "><a href="6.2.structured_and_unstructured_flow.html">6.2 Structured and Unstructured Flow</a></li><li class="chapter-item "><a href="6.3.sequencing.html">6.3 Sequencing</a></li><li class="chapter-item "><a href="6.4.selection.html">6.4 Selection</a></li><li class="chapter-item "><a href="6.5.iteration.html">6.5 Iteration</a></li><li class="chapter-item "><a href="6.6.recursion.html">6.6 Recursion</a></li><li class="chapter-item "><a href="6.7.nondeterminacy.html">6.7 Nondeterminacy</a></li></ol></li><li class="chapter-item expanded "><a href="7.type_systems.html">Chapter 7: Type Systems</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="7.1.overview.html">7.1 Overview</a></li><li class="chapter-item "><a href="7.2.type_checking.html">7.2 Type Checking</a></li><li class="chapter-item expanded "><a href="7.3.parametric_polymorphism.html" class="active">7.3 Parametric Polymorphism</a></li><li class="chapter-item "><a href="7.4.equality_tesing_and_assignment.html">7.4 Equality Tesing and Assignment</a></li></ol></li><li class="chapter-item "><a href="8.composite_types.html">Chapter 8: Composite Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="8.1.records_structures.html">8.1 Records(Structures)</a></li><li class="chapter-item "><a href="8.2.arrays.html">8.2 Arrays</a></li><li class="chapter-item "><a href="8.3.strings.html">8.3 Strings</a></li><li class="chapter-item "><a href="8.4.sets.html">8.4 Sets</a></li><li class="chapter-item "><a href="8.5.pointers_and_recursive_types.html">8.5 Pointers and Recursive Types</a></li><li class="chapter-item "><a href="8.6.lists.html">8.6 Lists</a></li><li class="chapter-item "><a href="8.7.files_and_input_output.html">8.7 Files and Input/Output</a></li></ol></li><li class="chapter-item "><a href="9.subroutines_and_control_abstraction.html">Chapter 9: Subroutines and Control Abstraction</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="9.1.review_of_stack_layout.html">9.1 Review of Stack Layout</a></li><li class="chapter-item "><a href="9.2.calling_sequences.html">9.2 Calling Sequences</a></li><li class="chapter-item "><a href="9.4.exception_handling.html">9.3 Parameter Passing</a></li><li class="chapter-item "><a href="9.5.coroutines.html">9.5 Coroutines</a></li><li class="chapter-item "><a href="9.6.events.html">9.6 Events</a></li></ol></li><li class="chapter-item "><a href="10.data_abstraction_and_object_orientation.html">Chapter 10: Data Abstraction and Object Orientation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="10.1.object_oriented_programming.html">10.1 Object-Oriented Programming</a></li><li class="chapter-item "><a href="10.2.encapsulation_and_inheritance.html">10.2 Encapsulation and Inheritance</a></li><li class="chapter-item "><a href="10.3.initialization_and_finalization.html">10.3 Initialization and Finalization</a></li><li class="chapter-item "><a href="10.4.dynamic_method_binding.html">10.4 Dynamic method Binding</a></li><li class="chapter-item "><a href="10.5.mix_in_inheritance.html">10.5 Mix in Inheritance</a></li><li class="chapter-item "><a href="10.6.true_multiple_inheritance.html">10.6 True Multiple Inheritance</a></li><li class="chapter-item "><a href="10.7.object_oriented_programming_revisited.html">10.7 Object-Oriented Progamming Revisited</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="part3.alternative_programming_models.html">Part III: Alternative Programming Models</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="11.functional_languages.html">Chapter 11: Functional Languages</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="11.1.historical_origins.html">11.1 Historical Origins</a></li><li class="chapter-item "><a href="11.2.functional_programming_concepts.html">11.2 Functional Programming Concepts</a></li><li class="chapter-item "><a href="11.3.a_bit_of_scheme.html">11.3 a Bit of Scheme</a></li><li class="chapter-item "><a href="11.4.a_bit_of_ocaml.html">11.4 a Bit of Ocaml</a></li><li class="chapter-item "><a href="11.5.evaluation_order_revisited.html">11.5 Evaluation Order Revisited</a></li><li class="chapter-item "><a href="11.6.higher_order_functions.html">11.6 Higher Order Functions</a></li><li class="chapter-item "><a href="11.7.theoretical_foundations.html">11.7 Theoretical Foundations</a></li><li class="chapter-item "><a href="11.8.functional_programming_in_perspective.html">11.8 Functional Programming in Perspective</a></li></ol></li><li class="chapter-item "><a href="12.logic_languages.html">Chapter 12: Logic Languages</a></li><li class="chapter-item "><a href="13.concurrency.html">Chapter 13: Concurrency</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="13.1.background_and_motivation.html">13.1 Background and Motivation</a></li><li class="chapter-item "><a href="13.2.concurrent_programming_fundamentals.html">13.2 Concurrent Programming Fundamentals</a></li><li class="chapter-item "><a href="13.3.implementing_synchronization.html">13.3 Implementing Synchronization</a></li><li class="chapter-item "><a href="13.4.language_level_constructs.html">13.4 Language Level Constructs</a></li><li class="chapter-item "><a href="13.5.message_passing.html">13.5 Message Passing</a></li><li class="chapter-item "><a href="13.6.summary_and_consluding_remarks.html">13.6 Summary and Concluding Remarks</a></li></ol></li><li class="chapter-item "><a href="14.scripting_languages.html">Chapter 14: Scripting Languages</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="14.1.what_is_a_scripting_language.html">14.1 What is a Scripting Language</a></li><li class="chapter-item "><a href="14.2.problem_domains.html">14.2 Problem Domains</a></li><li class="chapter-item "><a href="14.3.scriping_the_world_wide_web.html">14.3 Scripting the World Wide Web</a></li><li class="chapter-item "><a href="14.4.innovative_features.html">14.4 Innovative Features</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="part4.closer_look_at_implementation.html">Part IV: A Closer Look at Implementation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="15.building_a_runnable_program.html">Chapter 15: Building a Runnalble Program</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="15.1.back_end_compiler_structure.html">15.1 Back-end Compiler Structure</a></li><li class="chapter-item "><a href="15.2.intermediate_forms.html">15.2 Intermediate Forms</a></li><li class="chapter-item "><a href="15.3.code_generation.html">15.3 Code Generation</a></li><li class="chapter-item "><a href="15.4.address_space_organization.html">15.4 Address Space Organization</a></li><li class="chapter-item "><a href="15.5.assembly.html">15.5 Assembly</a></li><li class="chapter-item "><a href="15.6.linking.html">15.6 Linking</a></li><li class="chapter-item "><a href="15.7.dynamic_linking.html">15.7 Dynamic Linking</a></li></ol></li><li class="chapter-item "><a href="16.run-time_program_management.html">Chapter 16: Run-Time Program Management</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="16.1.virtual_machine.html">16.1 Virtual Machine</a></li><li class="chapter-item "><a href="16.2.late_binding_of_machine_code.html">16.2 Late Binding of Machine Code</a></li><li class="chapter-item "><a href="16.3.inspection_or_introspection.html">16.3 Inspection/Introspection</a></li></ol></li><li class="chapter-item "><a href="17.code_improvement.html">Chapter 17: Code Improvement</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">编程语言语用论（第4版）</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/CnTransGroup/programming_language_pragmatics_4th" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>我们在前面的小节已经看到，ML 家族的语言函数都是天生多态的。考虑下面的 OCaml 例子：</p>
<pre><code class="language-ocaml">let min x y = if x &lt; y then x else y;
</code></pre>
<p>可以应用于任何类型的参数，尽管有时内置的 <code>&lt;</code> 定义不符合程序员的需要。Haskell 中相同的函数可以用于类 Ord 的任何参数；程序员可以通过提供<code>&lt;</code>定义给这个类加入新类型【译者注：类似Rust中的 trait 】。强大的类型推导允许OCaml，Haskell编译器在编译期执行大多数类型检查。</p>
<p>在 OCaml 中，我们的<code>min</code>函数类型是 <code>'a-&gt;'a-&gt;'a</code>；Haskell 中是<code>Ord a =&gt; a -&gt; a -&gt;a</code>。显式声明的 x y，我们可以认为是隐式的类型参数。基于这个原因，可以说 ML 家族的语言都提供了隐式参数多态。</p>
<p>如果将类型检查推迟到运行期，没有编译器类型推导的语言也可以提供类似的便利和表达能力。在 Scheme 中，<code>min</code>函数可以这样写：</p>
<pre><code class="language-scheme">(define min (lambda (a b) (if (&lt; a b) a b)))
</code></pre>
<p>就像在 OCaml 或者 Haskell 中一样，没有提到类型。经典 Scheme 提供解释器在运行期检查。</p>
<p>类似的运行期检查也出现于面向对象语言 Smalltalk，然后在 Object-C,Swift, Ruby中也应用。</p>
<p>这种操作符支持类型（对象是否支持某个方法）的检查有时也称为鸭子类型（duck typing）。源自于“如果叫声和走路都像鸭子，那就是鸭子”。</p>
<h2 id="731-generic-subroutines-and-classes"><a class="header" href="#731-generic-subroutines-and-classes">7.3.1 Generic Subroutines and Classes</a></h2>
<p>Scheme，Smalltalk，Ruby 的缺点就是需要运行时检查，提升了开销，推迟了错误抛出。ML 家族语言的隐式参数多态避免了这几个问题，但是需要加强版类型推导。对于其他编译语言，显式参数多态（generics）允许程序员声明 subroutine 或者 class 时指定类型参数。编译器就可以使用这些参数用来静态类型检查。</p>
<p>提供了 generics 的语言有 Ada, C++,Eiffel, Java, C# 和 Scala。下图提供了具体的 subroutine 的例子，对于 Scala 语言，左边是 overload，右边是 generics。</p>
<p><img src="assets/7.3.parametric_polymorphism/image-20220916095916632.png" alt="image-20220916095916632" /></p>
<p>面向对象语言中，generics 也经常被用来参数化整个类。比如容器类：stack, queue, heap, set, dictionary abstractions -&gt; list, array, tree, hash tables。下图就是 C++ 的例子：</p>
<p><img src="assets/7.3.parametric_polymorphism/image-20220916100419668.png" alt="image-20220916100419668" /></p>
<p>缺少 generic 能力的语言（典型的就是 C）中，也有可能定义引用任意类型的 queue，但是需要编译期的类型转换。</p>
<p>我们可以将 generic parameters 看作支持编译期自定义，允许编译器创造特定版本的 subroutine 和 class 实例。有些语言中，比如 Java 和 C#，范型参数必须是类型。有些语言更泛化，比如 Ada 和 C++，范型参数不仅可以是类型，也可以是值，上面的 C++ 例子可以看到整型参数指定队列的最大长度。在 C++ 中，值必须是编译期常数；Ada 中，还支持动态长度的数组，计算推迟到 elaboration time（语义分析阶段）。</p>
<h3 id="impelentation-options"><a class="header" href="#impelentation-options">Impelentation Options</a></h3>
<p>Generics 可以通过几种方式实现。Ada 和 C++ 使用纯静态机制：所有创建和使用范型代码的工作都在编译期完成。通常情况下，编译器为每个实例代码创建单独的副本。（C++ 更甚于为每个实例安排类型检查）如果实例化后代码相同，编译器可以共享部分代码。但是并不是必须的，程序员不应该有这种假设。</p>
<p>相反，Java 保证所有范型实例在运行时共享相同代码。事实上，Java 的 T 如果是范型，实际上就是 Object。【译者注：就像是语法糖】C# 使用了中间方式，像 C++，为不同的 primitive 或者 value 类型创建泛化代码的特定实例。像 Java，要求泛化代码自己是类型安全的，不能提供实例化的特定参数。</p>
<h3 id="generic-parameter-constraints"><a class="header" href="#generic-parameter-constraints">Generic Parameter Constraints</a></h3>
<p>因为 generic 是抽象的，提供了抽象信息的接口就很重要。几种语言，比如 Ada，Java，C#，Scala，OCaml，SML 就试图通过约束范型参数强化这个规则。具体来说，就是要求范型参数类型上的操作必须显式声明。</p>
<p>在 Ada 中，程序员需要通过 with 子句指定范型参数上可以执行的操作。我们看一个简单例子</p>
<pre><code class="language-ada">generic 
	type T is private;
	type T_array is array (integer range &lt;&gt;) of T;
	with function &quot;&lt;&quot;(a1, a2: T) return boolean;
procedure sort(A: in out T_array);
</code></pre>
<p>没有 with 子句，sort 过程无法通过比较 A 排序，因为 T 是私有的 -- 只支持赋值，相等测试，和一些标准操作。</p>
<p>Java 和 C# 利用特殊的干净的方法来完成约束，利用面向对象类型的继承父类或者接口的机制。我们在 10 章完整讨论继承。现在，我们注意到 Java 和 C# 允许程序员指定范型参数允许特定的一系列接口，就像 Haskell 的参数类通过隐式多态函数约束类型可接受的参数。在 Java 中可以这样：</p>
<pre><code class="language-java">public static &lt;T extends Comparabel&lt;T&gt;&gt; void sort(T A[]) {
  ...
  if (A[i].compareTo(A[j]) &gt;= 0) ...
  ...
}
Integer[] myArray = new Integer[50];
sort(myArray);
</code></pre>
<p>对比 C++ 需要 <code>template&lt;type_args&gt;</code> 前缀，Java 将类型参数放在返回值之前。extends 子句表明类型 T 的约束：T 实现了 <code>Comparable</code> 接口。编译器就会检查类型是否实现了这个接口，因此保证了编译通过就可以调用 <code>compareTo</code> 方法。如果 T 需要实现多个接口可以 <code>&lt;T extends I1, I2, I3&gt;</code>，C# 的语法类似，不过使用 where 子句指定约束。</p>
<p>较少的语言不需要显式声明约束，但是还是会检查参数是否可用。比如在 C++ 中，</p>
<pre><code class="language-cpp">template&lt;typename T&gt;
void sort(T A[], int A_size) {...}
</code></pre>
<p>没有显式表明 T 需要可以比较。但是如果实例化之后的类型不能使用比较操作符，编译器会报语法错误。不幸的是，由于没有指定范型参数需要什么操作，程序员很难预测会报什么错。更糟糕的是，某些情况下，特定实例化代码操作满足范型代码要求的操作，但是可能无法做“正确的事”。比如 C++ 中，整数和浮点数是符合预期的，但是如果是字符串，就会比较地址，看那个小，如果程序员预期的是逐字符比较，就会出现错误结果。</p>
<p>为了避免这个问题，最好是显式声明约束。下一代版本的 C++（C++20）加入了这个能力。现在程序员可以模仿 Java，放在接口里。</p>
<h3 id="implicit-instantiation"><a class="header" href="#implicit-instantiation">Implicit Instantiation</a></h3>
<p>因为类就是一种类型，必须在实例化范型类之后才能用。这个 C++ 的声明提供了一种自然的方式：</p>
<pre><code class="language-cpp">queue&lt;int, 50&gt; *my_queue = new queue&lt;int, 50&gt;();
</code></pre>
<p>有些语言（比如 Ada）在使用前显式实例：</p>
<pre><code class="language-ada">procedure int_sort is new sort(integer, int_array, &quot;&lt;&quot;);
int_sort(my_array);
</code></pre>
<p>其他语言，比如 C++，Java，C#，不需要显式声明。代替的是将范型看作重载的一种形式。为了保持语言易于管理，C++ 中的隐式实例化规则比重载规则限制更多。尤其是，编译器不能 coerce 子历程参数来匹配包含范型参数的类型表达式。</p>
<p><img src="assets/7.3.parametric_polymorphism/image-20220916110341022.png" alt="image-20220916110341022" /></p>
<p>这个图总结了 Ada，C++，Java 和 C# 的generics 特性，以及 Lisp 和 ML 的隐式参数多态。<a href="../assets/supplementary_sections.pdf">扩展材料</a>C-7.3.2 中有更多阐述。</p>
<h2 id="732-generics-in-c-java-and-c"><a class="header" href="#732-generics-in-c-java-and-c">7.3.2 Generics in C++, Java and C#</a></h2>
<p>比较 C++ 和 Java 和 C# 对于generic 特性支持可以看到设计中的关键权衡。C++ 是最具雄心的。模板几乎可以完成所有需要相似但不同的抽象机制的编程。Java 和 C# 就更专注于多态。Java 的设计收到向后兼容的严重影响，不仅是语言的版本，还有虚拟机和标准库。C# 设计者虽然以现有语言为基础，但是并没有收到约束，从一开始就计划了 generic，并对 .NET 虚拟机提供了新的支持。</p>
<p><a href="../assets/supplementary_sections.pdf">网站内容</a> 中更具体讨论了 C++，Java 和 C# 中的 generics，考虑了不同设计对于错误信息的影响，以及生成代码的速度和数量，以及表达能力的强弱。我们注意到支持 类和方法的 generic 机制和广泛 generic 参数的支持机制非常不同。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="7.2.type_checking.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="7.4.equality_tesing_and_assignment.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="7.2.type_checking.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="7.4.equality_tesing_and_assignment.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
